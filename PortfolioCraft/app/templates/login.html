{% extends "base.html" %}

{% block content %}
<div class="min-h-screen flex items-center justify-center p-4">
  <div class="auth-container max-w-4xl w-full bg-white rounded-2xl shadow-xl overflow-hidden flex flex-col md:flex-row">

    <div class="w-full md:w-1/2 p-8 md:p-10">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold text-gray-800">Welcome Back</h2>
        <p class="text-gray-600 mt-2">Login to access your portfolio dashboard</p>
      </div>


      {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
      {% for category, message in messages %}
      {% if category == 'error' %}
      <div class="mb-4 text-center text-red-600 font-medium bg-red-50 border border-red-200 rounded-lg py-2">
        {{ message }}
      </div>
      {% endif %}
      {% endfor %}
      {% endif %}
      {% endwith %}


      <form method="POST" class="space-y-6" novalidate>
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
          <input type="email" id="email" name="email"
            class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-lavender transition"
            placeholder="you@example.com" required>
        </div>

        <div>
          <div class="flex justify-between items-center mb-1">
            <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
            <a href="/forgot-password" class="text-sm text-royalblue hover:underline">Forgot password?</a>
          </div>
          <input type="password" id="password" name="password"
            class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-lavender transition"
            placeholder="••••••••" required>
        </div>

        <div class="flex items-center">
          <input id="remember-me" name="remember-me" type="checkbox"
            class="h-4 w-4 text-royalblue focus:ring-royalblue border-gray-300 rounded">
          <label for="remember-me" class="ml-2 block text-sm text-gray-700">Remember me</label>
        </div>

        <button type="submit" class="btn-primary w-full py-3 px-4 rounded-lg text-white font-medium text-center">Sign
          In</button>
        <div class="btn-primary w-full py-3 px-4 rounded-lg text-white font-medium text-center">
          <a href="{{ url_for('admin.admin_login') }}">
            Admin Login
          </a>
        </div>


        <div class="or-divider text-sm">OR</div>

        <div class="grid grid-cols-2 gap-4">
          <button type="button"
            class="flex items-center justify-center py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
            <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M12.545 10.239v3.821h5.445c-0.712 2.315-2.647 3.972-5.445 3.972-3.332 0-6.033-2.701-6.033-6.032s2.701-6.032 6.033-6.032c1.498 0 2.866 0.549 3.921 1.453l2.814-2.814c-1.786-1.667-4.167-2.698-6.735-2.698-5.522 0-10 4.477-10 10s4.478 10 10 10c8.396 0 10-7.496 10-10 0-0.67-0.065-1.35-0.195-2.001h-9.805z" />
            </svg>
            Google
          </button>
          <button type="button"
            class="flex items-center justify-center py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
            <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" />
            </svg>
            LinkedIn
          </button>
        </div>

        <div class="text-center text-sm text-gray-600 mt-6">
          Don't have an account? <a href="{{ url_for('main.signup') }}"
            class="text-royalblue font-medium hover:underline">Sign up</a>
        </div>
      </form>
    </div>


    <div class="hidden md:block w-1/2 bg-gradient-to-br from-peach to-lavender relative overflow-hidden">
      <div class="absolute inset-0 flex items-center justify-center p-10">
        <div class="text-center">
          <div class="relative inline-block animate-float">
            <svg class="w-40 h-40 mx-auto text-royalblue opacity-90" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <path
                d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z"
                stroke="currentColor" stroke-width="2" />
              <path d="M8 14C8 14 9.5 16 12 16C14.5 16 16 14 16 14M9 10H9.01M15 10H15.01" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <div class="absolute -bottom-6 -right-6 w-16 h-16 bg-pink rounded-full opacity-70"></div>
          </div>
          <h3 class="text-2xl font-bold text-gray-800 mt-6">Build Your Professional Identity</h3>
          <p class="text-gray-700 mt-2">Showcase your skills with a beautiful portfolio</p>

          <div class="mt-8 text-left max-w-xs mx-auto space-y-4">
            <div class="flex items-start">
              <svg class="w-5 h-5 text-royalblue mt-0.5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              <span class="text-gray-700">AI-generated professional summaries</span>
            </div>
            <div class="flex items-start">
              <svg class="w-5 h-5 text-royalblue mt-0.5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              <span class="text-gray-700">Beautiful, customizable templates</span>
            </div>
            <div class="flex items-start">
              <svg class="w-5 h-5 text-royalblue mt-0.5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              <span class="text-gray-700">One-click publishing</span>
            </div>
          </div>
        </div>
      </div>


      <div
        class="absolute top-0 right-0 w-32 h-32 bg-white rounded-full opacity-10 transform translate-x-16 -translate-y-16">
      </div>
      <div
        class="absolute bottom-0 left-0 w-48 h-48 bg-white rounded-full opacity-10 transform -translate-x-16 translate-y-16">
      </div>
    </div>
  </div>
</div>

<script>

  function ensureErrorElement(fieldEl, id, defaultClass = "text-xs text-red-500 mt-1") {
    let err = document.getElementById(id);
    if (!err) {
      err = document.createElement('p');
      err.id = id;
      err.className = defaultClass + " hidden";
      fieldEl.insertAdjacentElement('afterend', err);
    }
    return err;
  }

  function showError(fieldEl, id, message) {
    const err = ensureErrorElement(fieldEl, id);
    err.textContent = message;
    err.classList.remove('hidden');
    fieldEl.classList.add('border-red-400', 'animate-pulse');
    setTimeout(() => fieldEl.classList.remove('animate-pulse'), 800);
  }

  function hideError(fieldEl, id) {
    const err = document.getElementById(id);
    if (err) err.classList.add('hidden');
    fieldEl.classList.remove('border-red-400');
  }


  (function setupLoginValidation() {
    const form = document.querySelector('form');
    if (!form) return;

    const emailField = document.getElementById('email');
    const passwordField = document.getElementById('password');


    if (emailField) {
      emailField.addEventListener('input', () => hideError(emailField, 'login-email-error'));
    }
    if (passwordField) {
      passwordField.addEventListener('input', () => hideError(passwordField, 'login-password-error'));
    }

    form.addEventListener('submit', function (e) {
      let valid = true;
      const emailVal = emailField ? emailField.value.trim() : '';
      const passwordVal = passwordField ? passwordField.value : '';


      if (!emailVal) {
        showError(emailField, 'login-email-error', 'Email is required');
        valid = false;
      } else {

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(emailVal)) {
          showError(emailField, 'login-email-error', 'Enter a valid email address');
          valid = false;
        } else {

          const parts = emailVal.split('@');
          const local = parts[0] || '';
          const domain = (parts[1] || '').toLowerCase();

          if (domain === 'gmail.com') {
            const gmailLocalRegex = /^[A-Za-z][A-Za-z0-9._+]*$/;
            if (!gmailLocalRegex.test(local)) {
              showError(emailField, 'login-email-error', 'For gmail.com use format like "a123@gmail.com" or "abc.123+label@gmail.com"');
              valid = false;
            } else {
              hideError(emailField, 'login-email-error');
            }
          } else {
            hideError(emailField, 'login-email-error');
          }
        }
      }


      if (!passwordVal) {
        showError(passwordField, 'login-password-error', 'Password is required');
        valid = false;
      } else {
        hideError(passwordField, 'login-password-error');
      }

      if (!valid) {
        e.preventDefault();

        const firstError = document.querySelector('.text-xs.text-red-500:not(.hidden)');
        if (firstError) firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    });
  })();
</script>
{% endblock %}